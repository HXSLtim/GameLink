## 模块概览
- `backend/internal/model/order.go` 定义订单结构与状态枚举（pending/confirmed/in_progress/completed/canceled/refunded），见 c:\Users\a2778\Desktop\code\GameLink\backend\internal\model\order.go:9–16；订单字段与护航/礼物扩展，见 c:\Users\a2778\Desktop\code\GameLink\backend\internal\model\order.go:18–68。
- `backend/internal/service/order/order.go` 提供订单创建、列表、详情、取消、完成、陪玩师接单/完成等核心业务，见 c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:173–231、233–275、277–372、374–423、425–460、732–770、772–825。
- `backend/internal/handler/user/order.go` 用户端路由：创建、列表、详情、取消、完成，见 c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\order.go:15–23。
- `backend/internal/handler/player/order.go` 陪玩师端路由：可接列表、接单、我接的订单、完成，见 c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\player\order.go:15–22。
- `backend/internal/handler/admin/order.go` 管理端订单全量操作（创建/指派/确认/开始/完成/取消/退款/查询/日志），见 c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:31–41、83–119、121–159、161–197、199–237、239–276、278–310、312–350、352–376、378–403、405–454、456–526、528–560、562–618。
- 支付模型与服务：`backend/internal/model/payment.go`（状态与结构，见 c:\Users\a2778\Desktop\code\GameLink\backend\internal\model\payment.go:12–26、28–45），`backend/internal/service/payment/payment.go`（创建支付→Mock自动成功→订单置 confirmed，退款等，见 c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\payment\payment.go:67–126、189–213、289–337）。

## 路由与端点
- 用户端（需认证）
  - `POST /user/orders` 创建订单（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\order.go:18、37–58）
  - `GET /user/orders` 我的订单列表（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\order.go:19、73–94）
  - `GET /user/orders/:id` 订单详情（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\order.go:20、109–139）
  - `PUT /user/orders/:id/cancel` 取消订单（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\order.go:21、154–188）
  - `PUT /user/orders/:id/complete` 完成订单（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\order.go:22、202–230）
- 用户端支付（需认证）
  - `POST /user/payments` 创建支付（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\payment.go:18、35–56）
  - `GET /user/payments/:id` 查询支付状态（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\payment.go:19、68–92）
  - `POST /user/payments/:id/cancel` 取消支付（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\payment.go:20、106–126）
- 陪玩师端（需认证）
  - `GET /player/orders/available` 可接订单大厅（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\player\order.go:18、38–60）
  - `POST /player/orders/:id/accept` 接单（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\player\order.go:19、73–97）
  - `GET /player/orders/my` 我接的订单（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\player\order.go:20、110–131）
  - `PUT /player/orders/:id/complete` 陪玩师完成（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\player\order.go:21、144–172）
- 管理端（需认证）
  - 创建：`POST /admin/orders`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:31–41）
  - 指派：`POST /admin/orders/:id/assign`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:83–119）
  - 确认：`POST /admin/orders/:id/confirm`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:121–159）
  - 开始：`POST /admin/orders/:id/start`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:161–197）
  - 完成：`POST /admin/orders/:id/complete`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:199–237）
  - 取消：`POST /admin/orders/:id/cancel`（端点在同文件，更新接口亦支持取消字段）
  - 退款：`POST /admin/orders/:id/refund`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:312–350）
  - 列表/详情：`GET /admin/orders`、`GET /admin/orders/:id`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:239–276、278–310）
  - 时间线/支付/退款/日志：相应 `GET` 端点见同文件（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:352–618、378–403、405–454、562–618）。

## 状态流转
- 订单状态：`pending`→`confirmed`→`in_progress`→`completed`，取消 `canceled`、退款 `refunded`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\model\order.go:9–16）。
- 用户取消仅允许 `pending/confirmed`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:387–423）；已支付取消会写入退款并置 `refunded`。
- 用户完成仅允许 `in_progress`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:438–460），完成后记录抽成（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:462–511）。
- 陪玩师接单将 `confirmed`→`in_progress` 并记录 `startedAt`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:758–769）。
- 支付成功（Mock或回调）将订单置 `confirmed`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\payment\payment.go:206–213、280–286）。

## 模拟演示流程（护航订单）
前提：后端服务运行在 `http://localhost:8080`；所有接口需 `Authorization: Bearer <token>`（用户或陪玩师角色）。

- 创建订单（用户）
  - `POST /user/orders`
  - 示例：
    - `curl -X POST http://localhost:8080/user/orders -H "Authorization: Bearer <user_token>" -H "Content-Type: application/json" -d '{"playerId":1,"gameId":1,"title":"开黑2小时","description":"黄金段位","scheduledStart":"2025-11-20T20:00:00Z","durationHours":2.0}'`
  - 返回 `orderId` 与 `priceCents`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:226–231）。
- 创建支付（用户）
  - `POST /user/payments`，`method` 为 `wechat` 或 `alipay`
  - 示例：
    - `curl -X POST http://localhost:8080/user/payments -H "Authorization: Bearer <user_token>" -H "Content-Type: application/json" -d '{"orderId":<orderId>,"method":"wechat"}'`
  - 返回 `paymentId` 与支付参数；Mock 将自动标记支付成功并把订单置为 `confirmed`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\payment\payment.go:113–126、206–213）。
- 可接订单大厅（陪玩师）
  - `GET /player/orders/available?gameId=1&page=1&pageSize=20`
  - 示例：`curl -X GET http://localhost:8080/player/orders/available -H "Authorization: Bearer <player_token>"`
- 接单（陪玩师）
  - `POST /player/orders/:id/accept`
  - 示例：`curl -X POST http://localhost:8080/player/orders/<orderId>/accept -H "Authorization: Bearer <player_token>"`
  - 订单转 `in_progress` 并记录 `startedAt`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:763–769）。
- 完成订单（陪玩师或用户）
  - 陪玩师：`PUT /player/orders/:id/complete`
    - `curl -X PUT http://localhost:8080/player/orders/<orderId>/complete -H "Authorization: Bearer <player_token>"`
  - 用户：`PUT /user/orders/:id/complete`
    - `curl -X PUT http://localhost:8080/user/orders/<orderId>/complete -H "Authorization: Bearer <user_token>"`
  - 订单转 `completed` 并记录抽成（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:808–824、452–459）。
- 取消/退款分支（用户）
  - `PUT /user/orders/:id/cancel`（仅 `pending/confirmed`）
    - `curl -X PUT http://localhost:8080/user/orders/<orderId>/cancel -H "Authorization: Bearer <user_token>" -H "Content-Type: application/json" -d '{"reason":"行程有变"}'`
  - 管理端退款：`POST /admin/orders/:id/refund` 或通过支付服务 `RefundPayment`（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\admin\order.go:312–350、c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\payment\payment.go:289–337）。
- 订单详情与时间线（用户）
  - `GET /user/orders/:id` 返回订单卡片、支付、评价与时间线（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:308–371）。

## 环境与前提
- 认证中间件从上下文 `user_id` 读取用户标识（c:\Users\a2778\Desktop\code\GameLink\backend\internal\handler\user\order.go:232–244）；需准备用户与陪玩师的有效令牌。
- 支付为 Mock 实现，创建支付后会自动置为已支付并确认订单；生产环境需改为等待真实支付回调（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\payment\payment.go:117–121、215–287）。
- 抽成记录在订单完成后生成，默认比率 20%（c:\Users\a2778\Desktop\code\GameLink\backend\internal\service\order\order.go:462–511）。

## 下一步执行
- 我将按照上述“模拟演示流程”使用 `curl`（或 Postman）串联完整业务：创建→支付→接单→完成，并演示取消/退款分支与时间线查询。
- 如需同时演示管理端流（指派/确认/开始/完成/退款/日志导出），可在后续步骤加入对应接口。

请确认是否按照该流程开始实际演示（默认使用 `localhost:8080` 与示例令牌占位符）。