# ğŸ—ï¸ GameLink ç³»ç»Ÿæ¶æ„è®¾è®¡

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç» GameLink æ¸¸æˆé™ªç©ç®¡ç†å¹³å°çš„ç³»ç»Ÿæ¶æ„è®¾è®¡ã€æŠ€æœ¯é€‰å‹å’Œè®¾è®¡ç†å¿µã€‚

---

## ğŸ“‹ ç›®å½•

- [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
- [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æ•°æ®æ¶æ„](#æ•°æ®æ¶æ„)
- [å®‰å…¨æ¶æ„](#å®‰å…¨æ¶æ„)
- [æ€§èƒ½æ¶æ„](#æ€§èƒ½æ¶æ„)
- [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
- [å¾®æœåŠ¡è®¾è®¡](#å¾®æœåŠ¡è®¾è®¡)
- [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)
- [é«˜å¯ç”¨è®¾è®¡](#é«˜å¯ç”¨è®¾è®¡)
- [ç›‘æ§ä½“ç³»](#ç›‘æ§ä½“ç³»)
- [æŠ€æœ¯å†³ç­–](#æŠ€æœ¯å†³ç­–)

---

## ğŸ¯ æ¶æ„æ¦‚è§ˆ

### ç³»ç»Ÿå®šä½
GameLink æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ¸¸æˆé™ªç©ç®¡ç†å¹³å°ï¼Œè¿æ¥æ¸¸æˆç©å®¶å’Œé™ªç©å¸ˆï¼Œæä¾›è®¢å•ç®¡ç†ã€æ”¯ä»˜ç»“ç®—ã€å®æ—¶é€šè®¯ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### ä¸šåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç”¨æˆ·ç«¯       â”‚    â”‚    é™ªç©å¸ˆç«¯     â”‚    â”‚    ç®¡ç†åå°     â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ â€¢ æ¸¸æˆæµè§ˆ      â”‚    â”‚ â€¢ å·¥ä½œå°        â”‚    â”‚ â€¢ ä»ªè¡¨ç›˜        â”‚
â”‚ â€¢ é™ªç©å¸ˆé€‰æ‹©    â”‚â—„â”€â”€â–ºâ”‚ â€¢ è®¢å•ç®¡ç†      â”‚â—„â”€â”€â–ºâ”‚ â€¢ ç”¨æˆ·ç®¡ç†      â”‚
â”‚ â€¢ è®¢å•åˆ›å»º      â”‚    â”‚ â€¢ æ”¶ç›Šç»Ÿè®¡      â”‚    â”‚ â€¢ è®¢å•ç›‘æ§      â”‚
â”‚ â€¢ æ”¯ä»˜è¯„ä»·      â”‚    â”‚ â€¢ æœåŠ¡ç®¡ç†      â”‚    â”‚ â€¢ è´¢åŠ¡ç®¡ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ ¸å¿ƒå¹³å°       â”‚
                    â”‚                â”‚
                    â”‚ â€¢ ç”¨æˆ·ç®¡ç†      â”‚
                    â”‚ â€¢ è®¢å•ç®¡ç†      â”‚
                    â”‚ â€¢ æ”¯ä»˜ç®¡ç†      â”‚
                    â”‚ â€¢ é€šè®¯æœåŠ¡      â”‚
                    â”‚ â€¢ é€šçŸ¥ç³»ç»Ÿ      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·æ¥å…¥å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Web åº”ç”¨      â”‚   ç§»åŠ¨ç«¯ App     â”‚      ç®¡ç†åå°              â”‚
â”‚   (React SPA)   â”‚   (React Native) â”‚      (React Admin)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API ç½‘å…³å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ è·¯ç”±è½¬å‘        â€¢ è´Ÿè½½å‡è¡¡        â€¢ é™æµæ§åˆ¶                â”‚
â”‚  â€¢ è®¤è¯æˆæƒ        â€¢ å‚æ•°éªŒè¯        â€¢ å“åº”ç¼“å­˜                â”‚
â”‚  â€¢ æ—¥å¿—è®°å½•        â€¢ ç›‘æ§ä¸ŠæŠ¥        â€¢ é”™è¯¯å¤„ç†                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡æœåŠ¡å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç”¨æˆ·æœåŠ¡      â”‚   è®¢å•æœåŠ¡      â”‚      æ”¯ä»˜æœåŠ¡              â”‚
â”‚   â€¢ æ³¨å†Œç™»å½•     â”‚   â€¢ è®¢å•ç®¡ç†     â”‚      â€¢ æ”¯ä»˜å¤„ç†            â”‚
â”‚   â€¢ èµ„æ–™ç®¡ç†     â”‚   â€¢ çŠ¶æ€æµè½¬     â”‚      â€¢ é€€æ¬¾å¤„ç†            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é™ªç©å¸ˆæœåŠ¡    â”‚   é€šè®¯æœåŠ¡      â”‚      é€šçŸ¥æœåŠ¡              â”‚
â”‚   â€¢ è®¤è¯å®¡æ ¸     â”‚   â€¢ å³æ—¶é€šè®¯     â”‚      â€¢ æ¶ˆæ¯æ¨é€            â”‚
â”‚   â€¢ æœåŠ¡ç®¡ç†     â”‚   â€¢ æ¶ˆæ¯å­˜å‚¨     â”‚      â€¢ é‚®ä»¶çŸ­ä¿¡            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åŸºç¡€æœåŠ¡å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®å­˜å‚¨      â”‚   ç¼“å­˜æœåŠ¡      â”‚      æ¶ˆæ¯é˜Ÿåˆ—              â”‚
â”‚   â€¢ MySQL       â”‚   â€¢ Redis       â”‚      â€¢ Redis Stream        â”‚
â”‚   â€¢ æ–‡ä»¶å­˜å‚¨     â”‚   â€¢ ä¼šè¯ç®¡ç†     â”‚      â€¢ äº‹ä»¶é©±åŠ¨            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ è®¾è®¡åŸåˆ™

### 1. SOLID åŸåˆ™
- **å•ä¸€èŒè´£åŸåˆ™**: æ¯ä¸ªæœåŠ¡åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ
- **å¼€é—­åŸåˆ™**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
- **é‡Œæ°æ›¿æ¢åŸåˆ™**: å­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»
- **æ¥å£éš”ç¦»åŸåˆ™**: æ¥å£ç»†ç²’åº¦ï¼Œä¸å¼ºè¿«ä¾èµ–ä¸éœ€è¦çš„åŠŸèƒ½
- **ä¾èµ–å€’ç½®åŸåˆ™**: ä¾èµ–æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°

### 2. é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)
- **é™ç•Œä¸Šä¸‹æ–‡**: æ˜ç¡®çš„ä¸šåŠ¡è¾¹ç•Œ
- **èšåˆæ ¹**: ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **é¢†åŸŸäº‹ä»¶**: æ¾è€¦åˆçš„é¢†åŸŸäº¤äº’
- **å€¼å¯¹è±¡**: ä¸å¯å˜çš„ä¸šåŠ¡æ¦‚å¿µ

### 3. å¾®æœåŠ¡åŸåˆ™
- **å•ä¸€èŒè´£**: æ¯ä¸ªæœåŠ¡ä¸“æ³¨ä¸€ä¸ªä¸šåŠ¡
- **è‡ªæ²»æ€§**: ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€æ‰©å±•
- **å»ä¸­å¿ƒåŒ–**: é¿å…å•ç‚¹æ•…éšœ
- **å®¹é”™è®¾è®¡**: ä¼˜é›…é™çº§å’Œç†”æ–­

### 4. äº‘åŸç”ŸåŸåˆ™
- **å®¹å™¨åŒ–**: æœåŠ¡å®¹å™¨åŒ–éƒ¨ç½²
- **æ— çŠ¶æ€**: æœåŠ¡ä¸ä¿å­˜çŠ¶æ€ä¿¡æ¯
- **å¯è§‚æµ‹**: å®Œæ•´çš„ç›‘æ§å’Œæ—¥å¿—
- **å¼¹æ€§**: è‡ªåŠ¨æ‰©ç¼©å®¹

---

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆé€‰æ‹©

#### åç«¯æŠ€æœ¯æ ˆ
```
è¯­è¨€æ¡†æ¶: Go 1.25.3 + Gin
Webæ¡†æ¶: Gin (è½»é‡çº§é«˜æ€§èƒ½)
ORMæ¡†æ¶: GORM (åŠŸèƒ½ä¸°å¯Œ)
æ•°æ®åº“: MySQL 8.0 (ä¸»æ•°æ®åº“)
ç¼“å­˜: Redis 6.0 (ç¼“å­˜+ä¼šè¯)
æ¶ˆæ¯é˜Ÿåˆ—: Redis Stream (è½»é‡çº§)
æ–‡ä»¶å­˜å‚¨: MinIO (S3å…¼å®¹)
æœç´¢: Elasticsearch (å…¨æ–‡æ£€ç´¢)
ç›‘æ§: Prometheus + Grafana
æ—¥å¿—: ELK Stack (Elasticsearch + Logstash + Kibana)
```

#### å‰ç«¯æŠ€æœ¯æ ˆ
```
è¯­è¨€: TypeScript 4.8+
æ¡†æ¶: React 18 + Hooks
æ„å»ºå·¥å…·: Vite (å¿«é€Ÿæ„å»º)
è·¯ç”±: React Router v6
çŠ¶æ€ç®¡ç†: Zustand (è½»é‡çº§)
HTTPå®¢æˆ·ç«¯: Axios
UIç»„ä»¶åº“: Ant Design + Tailwind CSS
æ ·å¼æ–¹æ¡ˆ: Less + CSS Modules
æµ‹è¯•æ¡†æ¶: Vitest + Testing Library
```

#### åŸºç¡€è®¾æ–½
```
å®¹å™¨: Docker + Docker Compose
ç¼–æ’: Kubernetes (ç”Ÿäº§ç¯å¢ƒ)
ç½‘å…³: Nginx + Kong
CI/CD: GitHub Actions
ç›‘æ§: Prometheus + Grafana + Jaeger
æ—¥å¿—: Filebeat + ELK Stack
å®‰å…¨: Let's Encrypt + OAuth2
```

### æ¶æ„åˆ†å±‚

#### 1. è¡¨ç°å±‚ (Presentation Layer)
```go
// HTTP Handler å±‚
type UserHandler struct {
    userService service.UserService
}

func (h *UserHandler) Register(c *gin.Context) {
    var req RegisterRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(400, ErrorResponse(err))
        return
    }

    user, err := h.userService.Register(req)
    if err != nil {
        c.JSON(500, ErrorResponse(err))
        return
    }

    c.JSON(201, SuccessResponse(user))
}
```

#### 2. åº”ç”¨å±‚ (Application Layer)
```go
// Service å±‚
type UserService struct {
    userRepo repository.UserRepository
    cache    cache.Cache
    eventBus EventBus
}

func (s *UserService) Register(req RegisterRequest) (*User, error) {
    // ä¸šåŠ¡é€»è¾‘å¤„ç†
    if exists, _ := s.userRepo.ExistsByEmail(req.Email); exists {
        return nil, ErrEmailAlreadyExists
    }

    user := &User{
        Email:    req.Email,
        Username: req.Username,
        Password: s.hashPassword(req.Password),
    }

    if err := s.userRepo.Create(user); err != nil {
        return nil, err
    }

    // å‘å¸ƒé¢†åŸŸäº‹ä»¶
    s.eventBus.Publish(UserRegisteredEvent{UserID: user.ID})

    return user, nil
}
```

#### 3. é¢†åŸŸå±‚ (Domain Layer)
```go
// é¢†åŸŸæ¨¡å‹
type User struct {
    ID        int64     `json:"id"`
    Username  string    `json:"username"`
    Email     string    `json:"email"`
    Password  string    `json:"-"`
    Status    UserStatus `json:"status"`
    CreatedAt time.Time `json:"created_at"`
    UpdatedAt time.Time `json:"updated_at"`
}

type UserStatus string

const (
    UserStatusActive   UserStatus = "active"
    UserStatusInactive UserStatus = "inactive"
    UserStatusLocked   UserStatus = "locked"
)

func (u *User) IsActive() bool {
    return u.Status == UserStatusActive
}
```

#### 4. åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)
```go
// Repository å®ç°
type UserRepository struct {
    db *gorm.DB
}

func (r *UserRepository) Create(user *User) error {
    return r.db.Create(user).Error
}

func (r *UserRepository) FindByEmail(email string) (*User, error) {
    var user User
    err := r.db.Where("email = ?", email).First(&user).Error
    if err == gorm.ErrRecordNotFound {
        return nil, ErrUserNotFound
    }
    return &user, err
}
```

---

## ğŸ“Š æ•°æ®æ¶æ„

### æ•°æ®åº“è®¾è®¡

#### æ ¸å¿ƒå®ä½“å…³ç³»
```
User (ç”¨æˆ·)
â”œâ”€â”€ Player (é™ªç©å¸ˆ) ä¸€å¯¹ä¸€
â”œâ”€â”€ Order (è®¢å•) ä¸€å¯¹å¤š
â”œâ”€â”€ Payment (æ”¯ä»˜) ä¸€å¯¹å¤š
â””â”€â”€ Review (è¯„ä»·) ä¸€å¯¹å¤š

Game (æ¸¸æˆ)
â”œâ”€â”€ PlayerGame (é™ªç©å¸ˆæ¸¸æˆ) å¤šå¯¹å¤š
â””â”€â”€ Order (è®¢å•) ä¸€å¯¹å¤š

Order (è®¢å•)
â”œâ”€â”€ OrderItem (è®¢å•é¡¹) ä¸€å¯¹å¤š
â”œâ”€â”€ Payment (æ”¯ä»˜) ä¸€å¯¹å¤š
â”œâ”€â”€ Review (è¯„ä»·) ä¸€å¯¹ä¸€
â””â”€â”€ ChatGroup (èŠå¤©ç¾¤ç»„) ä¸€å¯¹ä¸€

ChatGroup (èŠå¤©ç¾¤ç»„)
â””â”€â”€ ChatMessage (èŠå¤©æ¶ˆæ¯) ä¸€å¯¹å¤š
```

#### æ•°æ®åˆ†ç‰‡ç­–ç•¥
```sql
-- æŒ‰ç”¨æˆ·IDåˆ†ç‰‡
CREATE TABLE orders_0001 LIKE orders;
CREATE TABLE orders_0002 LIKE orders;
-- ... æ›´å¤šåˆ†ç‰‡

-- åˆ†ç‰‡è·¯ç”±å‡½æ•°
CREATE FUNCTION get_order_shard(user_id BIGINT) RETURNS INT
DETERMINISTIC
BEGIN
    RETURN (user_id % 16) + 1;
END;
```

#### æ•°æ®ç¼“å­˜ç­–ç•¥
```go
// å¤šçº§ç¼“å­˜
type CacheStrategy struct {
    L1Cache *sync.Map          // æœ¬åœ°å†…å­˜ç¼“å­˜
    L2Cache *redis.Client     // Redis ç¼“å­˜
    L3Cache *memcached.Client  // Memcached ç¼“å­˜
}

func (c *CacheStrategy) Get(key string) (interface{}, bool) {
    // L1 ç¼“å­˜
    if value, ok := c.L1Cache.Load(key); ok {
        return value, true
    }

    // L2 ç¼“å­˜
    if value, err := c.L2Cache.Get(key).Result(); err == nil {
        c.L1Cache.Store(key, value)
        return value, true
    }

    // L3 ç¼“å­˜
    if value, err := c.L3Cache.Get(key); err == nil {
        c.L2Cache.Set(key, value, time.Hour)
        c.L1Cache.Store(key, value)
        return value, true
    }

    return nil, false
}
```

---

## ğŸ”’ å®‰å…¨æ¶æ„

### è®¤è¯æˆæƒæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯åº”ç”¨     â”‚    â”‚   API ç½‘å…³      â”‚    â”‚   ä¸šåŠ¡æœåŠ¡      â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ â€¢ Token å­˜å‚¨     â”‚â—„â”€â”€â–ºâ”‚ â€¢ Token éªŒè¯     â”‚â—„â”€â”€â–ºâ”‚ â€¢ æƒé™æ£€æŸ¥      â”‚
â”‚ â€¢ è‡ªåŠ¨åˆ·æ–°      â”‚    â”‚ â€¢ ç”¨æˆ·ä¿¡æ¯      â”‚    â”‚ â€¢ ä¸šåŠ¡é€»è¾‘      â”‚
â”‚ â€¢ ç™»å‡ºå¤„ç†      â”‚    â”‚ â€¢ æƒé™ä¼ é€’      â”‚    â”‚ â€¢ å®¡è®¡æ—¥å¿—      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### JWT Token è®¾è®¡
```go
type JWTClaims struct {
    UserID   int64    `json:"user_id"`
    Username string   `json:"username"`
    Roles    []string `json:"roles"`
    TokenID  string   `json:"jti"`     // Token ID
    jwt.RegisteredClaims
}

// Token ç®¡ç†
type TokenManager struct {
    secretKey     []byte
    accessTokenT  time.Duration
    refreshTokenT time.Duration
    blackList     map[string]bool
}

func (tm *TokenManager) GenerateToken(user *User) (*TokenPair, error) {
    // Access Token
    accessToken := jwt.NewWithClaims(jwt.SigningMethodHS256, JWTClaims{
        UserID:   user.ID,
        Username: user.Username,
        Roles:    user.GetRoles(),
        TokenID:  uuid.New().String(),
        RegisteredClaims: jwt.RegisteredClaims{
            ExpiresAt: jwt.NewNumericDate(time.Now().Add(tm.accessTokenT)),
            IssuedAt:  jwt.NewNumericDate(time.Now()),
            Issuer:    "gamelink",
        },
    })

    // Refresh Token
    refreshToken := jwt.NewWithClaims(jwt.SigningMethodHS256, JWTClaims{
        UserID:   user.ID,
        TokenID:  uuid.New().String(),
        RegisteredClaims: jwt.RegisteredClaims{
            ExpiresAt: jwt.NewNumericDate(time.Now().Add(tm.refreshTokenT)),
            Issuer:    "gamelink",
        },
    })

    return &TokenPair{
        AccessToken:  accessToken.SignedString(tm.secretKey),
        RefreshToken: refreshToken.SignedString(tm.secretKey),
        ExpiresIn:   int(tm.accessTokenT.Seconds()),
    }, nil
}
```

#### RBAC æƒé™æ¨¡å‹
```go
// æƒé™å®šä¹‰
type Permission struct {
    ID       int64  `json:"id"`
    Resource string `json:"resource"`  // èµ„æº
    Action   string `json:"action"`    // æ“ä½œ
    Scope    string `json:"scope"`     // èŒƒå›´
}

// è§’è‰²å®šä¹‰
type Role struct {
    ID          int64        `json:"id"`
    Name        string       `json:"name"`
    Permissions []Permission `json:"permissions"`
}

// æƒé™æ£€æŸ¥ä¸­é—´ä»¶
func RBACMiddleware(resource, action string) gin.HandlerFunc {
    return func(c *gin.Context) {
        userID := c.GetInt64("user_id")
        roles := c.GetStringSlice("user_roles")

        // æ£€æŸ¥æƒé™
        hasPermission, err := authService.CheckPermission(userID, roles, resource, action)
        if err != nil || !hasPermission {
            c.JSON(403, ErrorResponse(ErrPermissionDenied))
            c.Abort()
            return
        }

        c.Next()
    }
}
```

---

## âš¡ æ€§èƒ½æ¶æ„

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. æ•°æ®åº“ä¼˜åŒ–
```sql
-- ç´¢å¼•ç­–ç•¥
CREATE INDEX idx_orders_user_status ON orders(user_id, status);
CREATE INDEX idx_orders_created_at ON orders(created_at DESC);
CREATE INDEX idx_players_game_rating ON players(game_id, rating DESC);

-- åˆ†åŒºè¡¨
CREATE TABLE orders (
    id BIGINT AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    -- å…¶ä»–å­—æ®µ...
    PRIMARY KEY (id, created_at)
) PARTITION BY RANGE (YEAR(created_at)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026)
);
```

#### 2. ç¼“å­˜æ¶æ„
```go
// ç¼“å­˜ç­–ç•¥
type CacheConfig struct {
    UserCache      CacheSettings `yaml:"user_cache"`
    OrderCache     CacheSettings `yaml:"order_cache"`
    GameCache      CacheSettings `yaml:"game_cache"`
    PaymentCache   CacheSettings `yaml:"payment_cache"`
}

type CacheSettings struct {
    TTL        time.Duration `yaml:"ttl"`
    MaxSize    int           `yaml:"max_size"`
    EvictPolicy string       `yaml:"evict_policy"`  // lru, lfu, fifo
}

// ç¼“å­˜ä½¿ç”¨ç¤ºä¾‹
func (s *UserService) GetUser(id int64) (*User, error) {
    cacheKey := fmt.Sprintf("user:%d", id)

    // å°è¯•ä»ç¼“å­˜è·å–
    var user User
    if err := s.cache.Get(cacheKey, &user); err == nil {
        return &user, nil
    }

    // ä»æ•°æ®åº“è·å–
    user, err := s.userRepo.FindByID(id)
    if err != nil {
        return nil, err
    }

    // å†™å…¥ç¼“å­˜
    s.cache.Set(cacheKey, user, s.config.UserCache.TTL)

    return &user, nil
}
```

#### 3. å¼‚æ­¥å¤„ç†
```go
// äº‹ä»¶é©±åŠ¨æ¶æ„
type EventBus interface {
    Publish(event Event) error
    Subscribe(topic string, handler EventHandler) error
}

// äº‹ä»¶å®šä¹‰
type OrderCreatedEvent struct {
    OrderID   int64     `json:"order_id"`
    UserID    int64     `json:"user_id"`
    PlayerID  int64     `json:"player_id"`
    Amount    int64     `json:"amount"`
    CreatedAt time.Time `json:"created_at"`
}

// äº‹ä»¶å¤„ç†å™¨
type NotificationHandler struct {
    notificationService NotificationService
}

func (h *NotificationHandler) HandleOrderCreated(event OrderCreatedEvent) error {
    // å‘é€ç”¨æˆ·é€šçŸ¥
    h.notificationService.SendUserNotification(event.UserID, "è®¢å•åˆ›å»ºæˆåŠŸ")

    // å‘é€é™ªç©å¸ˆé€šçŸ¥
    h.notificationService.SendPlayerNotification(event.PlayerID, "æ”¶åˆ°æ–°è®¢å•")

    return nil
}
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM golang:1.25.3-alpine AS builder

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -o main ./cmd/user-service

FROM alpine:latest
RUN apk --no-cache add ca-certificates tzdata
WORKDIR /app

COPY --from=builder /app/main .
COPY --from=builder /app/configs ./configs

EXPOSE 8080
CMD ["./main"]
```

### Kubernetes éƒ¨ç½²
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gamelink-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: gamelink-api
  template:
    metadata:
      labels:
        app: gamelink-api
    spec:
      containers:
      - name: api
        image: gamelink/api:latest
        ports:
        - containerPort: 8080
        env:
        - name: DB_HOST
          value: "mysql-service"
        - name: REDIS_HOST
          value: "redis-service"
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: gamelink-api-service
spec:
  selector:
    app: gamelink-api
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: LoadBalancer
```

---

## ğŸ”§ å¾®æœåŠ¡è®¾è®¡

### æœåŠ¡æ‹†åˆ†åŸåˆ™
1. **ä¸šåŠ¡è¾¹ç•Œæ¸…æ™°**: æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†
2. **æ•°æ®ç‹¬ç«‹æ€§**: æ¯ä¸ªæœåŠ¡æœ‰è‡ªå·±çš„æ•°æ®åº“
3. **æ¥å£ç¨³å®šæ€§**: é€šè¿‡ API ç½‘å…³ç»Ÿä¸€å¯¹å¤–
4. **æ•…éšœéš”ç¦»**: å•ä¸ªæœåŠ¡æ•…éšœä¸å½±å“æ•´ä½“

### æœåŠ¡é—´é€šä¿¡
```go
// åŒæ­¥é€šä¿¡ - HTTP REST
type OrderServiceClient struct {
    baseURL string
    client  *http.Client
}

func (c *OrderServiceClient) CreateOrder(req CreateOrderRequest) (*Order, error) {
    url := fmt.Sprintf("%s/orders", c.baseURL)

    resp, err := c.client.Post(url, "application/json", req.ToJSON())
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()

    var order Order
    if err := json.NewDecoder(resp.Body).Decode(&order); err != nil {
        return nil, err
    }

    return &order, nil
}

// å¼‚æ­¥é€šä¿¡ - æ¶ˆæ¯é˜Ÿåˆ—
type MessageProducer interface {
    Publish(topic string, message interface{}) error
}

type OrderProducer struct {
    producer MessageProducer
}

func (p *OrderProducer) OrderCreated(order *Order) error {
    event := OrderCreatedEvent{
        OrderID:  order.ID,
        UserID:   order.UserID,
        PlayerID: order.PlayerID,
        Amount:   order.Amount,
    }

    return p.producer.Publish("order.created", event)
}
```

---

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•
```go
// æ— çŠ¶æ€æœåŠ¡è®¾è®¡
type UserService struct {
    repo   UserRepository
    cache  Cache
    events EventBus
}

// æ‰€æœ‰çŠ¶æ€éƒ½å­˜å‚¨åœ¨å¤–éƒ¨ç³»ç»Ÿ
func (s *UserService) GetUser(id int64) (*User, error) {
    // ä»ç¼“å­˜è·å–
    if user, err := s.cache.Get(fmt.Sprintf("user:%d", id)); err == nil {
        return user.(*User), nil
    }

    // ä»æ•°æ®åº“è·å–
    user, err := s.repo.FindByID(id)
    if err != nil {
        return nil, err
    }

    // å†™å…¥ç¼“å­˜
    s.cache.Set(fmt.Sprintf("user:%d", id), user, 5*time.Minute)

    return user, nil
}
```

### æ•°æ®åº“æ‰©å±•
```go
// è¯»å†™åˆ†ç¦»
type UserRepository struct {
    writeDB *gorm.DB  // ä¸»åº“
    readDB  *gorm.DB  // ä»åº“
}

func (r *UserRepository) Create(user *User) error {
    return r.writeDB.Create(user).Error
}

func (r *UserRepository) FindByID(id int64) (*User, error) {
    var user User
    err := r.readDB.First(&user, id).Error
    return &user, err
}

// åˆ†åº“åˆ†è¡¨
type ShardingStrategy interface {
    GetShard(userID int64) string
    GetTable(orderID int64) string
}

type UserShardingStrategy struct{}

func (s *UserShardingStrategy) GetShard(userID int64) string {
    return fmt.Sprintf("user_db_%02d", userID%4)
}

func (s *UserShardingStrategy) GetTable(orderID int64) string {
    return fmt.Sprintf("orders_%04d", orderID%100)
}
```

---

## ğŸ›¡ï¸ é«˜å¯ç”¨è®¾è®¡

### æœåŠ¡å®¹é”™
```go
// ç†”æ–­å™¨æ¨¡å¼
type CircuitBreaker struct {
    maxFailures   int
    timeout       time.Duration
    failures      int
    lastFailTime  time.Time
    state         State
    mutex         sync.RWMutex
}

type State int

const (
    StateClosed State = iota
    StateHalfOpen
    StateOpen
)

func (cb *CircuitBreaker) Call(fn func() error) error {
    cb.mutex.Lock()
    defer cb.mutex.Unlock()

    if cb.state == StateOpen {
        if time.Since(cb.lastFailTime) > cb.timeout {
            cb.state = StateHalfOpen
        } else {
            return ErrCircuitBreakerOpen
        }
    }

    err := fn()
    if err != nil {
        cb.failures++
        cb.lastFailTime = time.Now()

        if cb.failures >= cb.maxFailures {
            cb.state = StateOpen
        }
        return err
    }

    cb.failures = 0
    cb.state = StateClosed
    return nil
}

// ä½¿ç”¨ç¤ºä¾‹
func (s *UserService) GetUserWithCircuitBreaker(id int64) (*User, error) {
    var user *User
    err := s.circuitBreaker.Call(func() error {
        var err error
        user, err = s.userRepo.FindByID(id)
        return err
    })

    if err != nil {
        // é™çº§å¤„ç†
        return s.getFromCache(id)
    }

    return user, nil
}
```

### é™æµç­–ç•¥
```go
// ä»¤ç‰Œæ¡¶ç®—æ³•
type RateLimiter struct {
    tokens       int
    capacity     int
    refillRate   int
    lastRefill   time.Time
    mutex        sync.Mutex
}

func (rl *RateLimiter) Allow() bool {
    rl.mutex.Lock()
    defer rl.mutex.Unlock()

    now := time.Now()
    elapsed := now.Sub(rl.lastRefill)
    tokensToAdd := int(elapsed.Seconds()) * rl.refillRate

    if tokensToAdd > 0 {
        rl.tokens = min(rl.capacity, rl.tokens+tokensToAdd)
        rl.lastRefill = now
    }

    if rl.tokens > 0 {
        rl.tokens--
        return true
    }

    return false
}

// é™æµä¸­é—´ä»¶
func RateLimitMiddleware(limiter *RateLimiter) gin.HandlerFunc {
    return func(c *gin.Context) {
        if !limiter.Allow() {
            c.JSON(429, ErrorResponse(ErrRateLimited))
            c.Abort()
            return
        }
        c.Next()
    }
}
```

---

## ğŸ“Š ç›‘æ§ä½“ç³»

### ç›‘æ§æŒ‡æ ‡
```go
// ä¸šåŠ¡æŒ‡æ ‡
var (
    OrderCreatedCounter = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "orders_created_total",
            Help: "Total number of orders created",
        },
        []string{"game_id", "service_type"},
    )

    OrderProcessingDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "order_processing_duration_seconds",
            Help: "Order processing duration",
        },
        []string{"status"},
    )

    ActiveUsersGauge = prometheus.NewGauge(
        prometheus.GaugeOpts{
            Name: "active_users_total",
            Help: "Number of active users",
        },
    )
)

// ç³»ç»ŸæŒ‡æ ‡
var (
    HTTPRequestDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "http_request_duration_seconds",
            Help: "HTTP request duration",
        },
        []string{"method", "endpoint", "status"},
    )

    DatabaseConnectionsGauge = prometheus.NewGauge(
        prometheus.GaugeOpts{
            Name: "database_connections_active",
            Help: "Number of active database connections",
        },
    )
)
```

### æ—¥å¿—æ¶æ„
```go
// ç»“æ„åŒ–æ—¥å¿—
type Logger struct {
    logger *logrus.Logger
}

func (l *Logger) WithRequest(c *gin.Context) *logrus.Entry {
    return l.logger.WithFields(logrus.Fields{
        "request_id": c.GetString("request_id"),
        "user_id":    c.GetInt64("user_id"),
        "method":     c.Request.Method,
        "path":       c.Request.URL.Path,
        "ip":         c.ClientIP(),
        "user_agent": c.Request.UserAgent(),
    })
}

// é“¾è·¯è¿½è¸ª
func TracingMiddleware() gin.HandlerFunc {
    return gin.HandlerFunc(func(c *gin.Context) {
        // ç”Ÿæˆè¿½è¸ªID
        traceID := uuid.New().String()
        c.Set("trace_id", traceID)

        // æ·»åŠ åˆ°æ—¥å¿—ä¸Šä¸‹æ–‡
        logger := logrus.WithField("trace_id", traceID)
        c.Set("logger", logger)

        c.Next()
    })
}
```

---

## ğŸ¤” æŠ€æœ¯å†³ç­–

### 1. ä¸ºä»€ä¹ˆé€‰æ‹© Goï¼Ÿ
- **æ€§èƒ½**: é«˜å¹¶å‘æ€§èƒ½ä¼˜ç§€
- **ç®€æ´**: è¯­æ³•ç®€æ´ï¼Œå­¦ä¹ æˆæœ¬ä½
- **ç”Ÿæ€**: ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“
- **éƒ¨ç½²**: å•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéƒ¨ç½²ç®€å•
- **å¹¶å‘**: åŸç”Ÿæ”¯æŒåç¨‹

### 2. ä¸ºä»€ä¹ˆé€‰æ‹© Reactï¼Ÿ
- **ç”Ÿæ€**: æˆç†Ÿçš„å‰ç«¯ç”Ÿæ€
- **æ€§èƒ½**: è™šæ‹ŸDOMï¼Œæ€§èƒ½ä¼˜ç§€
- **å¼€å‘**: ç»„ä»¶åŒ–å¼€å‘ï¼Œå¯ç»´æŠ¤æ€§å¥½
- **ç¤¾åŒº**: æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒ

### 3. ä¸ºä»€ä¹ˆé€‰æ‹© MySQLï¼Ÿ
- **æˆç†Ÿ**: ç¨³å®šçš„å…³ç³»å‹æ•°æ®åº“
- **äº‹åŠ¡**: ACIDç‰¹æ€§ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **å·¥å…·**: ä¸°å¯Œçš„ç®¡ç†å’Œç›‘æ§å·¥å…·
- **æ‰©å±•**: æ”¯æŒä¸»ä»å¤åˆ¶å’Œåˆ†ç‰‡

### 4. ä¸ºä»€ä¹ˆé€‰æ‹© Redisï¼Ÿ
- **æ€§èƒ½**: å†…å­˜å­˜å‚¨ï¼Œè¯»å†™é€Ÿåº¦å¿«
- **æ•°æ®ç±»å‹**: æ”¯æŒå¤šç§æ•°æ®ç»“æ„
- **æŒä¹…åŒ–**: æ”¯æŒæ•°æ®æŒä¹…åŒ–
- **é›†ç¾¤**: æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ¶æ„å›¢é˜Ÿ
- **é¦–å¸­æ¶æ„å¸ˆ**: architech@gamelink.com
- **åç«¯æ¶æ„**: backend-arch@gamelink.com
- **å‰ç«¯æ¶æ„**: frontend-arch@gamelink.com
- **è¿ç»´æ¶æ„**: devops@gamelink.com

### æ–‡æ¡£ç»´æŠ¤
- **æ¶æ„æ–‡æ¡£**: https://docs.gamelink.com/architecture
- **APIæ–‡æ¡£**: https://docs.gamelink.com/api
- **éƒ¨ç½²æŒ‡å—**: https://docs.gamelink.com/deployment

---

*æœ¬æ–‡æ¡£éšç³»ç»Ÿæ¼”è¿›æŒç»­æ›´æ–°ï¼Œæœ€åæ›´æ–°: 2025-11-13*